<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Kalam:wght@700&display=swap" rel="stylesheet">

  <style>

    /* GLOBAL MOBILE STYLES */
    @media (max-width: 600px) {
      body {
        padding: 0 10px;
      }
      .card, .container, .content {
        width: 100% !important;
        max-width: 100% !important;
        padding: 1rem !important;
      }
      img {
        max-width: 100%;
        height: auto;
      }
      button, .btn, .button {
        width: 100% !important;
        font-size: 1rem !important;
      }
      input, select, textarea {
        width: 100% !important;
        font-size: 1rem;
      }
    }

    *{margin:0;padding:0;box-sizing:border-box;font-family:'Baloo 2','Kalam',sans-serif}
    body{
      background:url('Bg.png') no-repeat center center fixed;
      background-size:cover;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
      position:relative;
    }

    .overlay{
      position:absolute;top:0;left:0;width:100%;height:100%;
      background:rgba(255,255,255,0.7);z-index:0
    }

    .logout-btn{
      position:absolute;top:20px;right:20px;
      background:#BFE7BC;border:none;border-radius:12px;
      padding:10px 20px;cursor:pointer;font-weight:700;
      font-size:.95rem;color:#1A2B10;z-index:3;
      transition:all .18s
    }
    .logout-btn:hover{background:#A5D39B;transform:translateY(-2px)}

    .container{
      position:relative;z-index:2;
      text-align:center;
      display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      width:100%;max-width:420px;
    }

    h1{
      color:#2e5015;font-size:2.2rem;font-weight:700;
      margin-bottom:2.5rem;letter-spacing:.5px
    }

    .button{
      background:#BFE7BC;color:#1A2B10;border:none;
      border-radius:20px;padding:14px 40px;
      margin:10px 0;font-size:1.15rem;font-weight:600;
      cursor:pointer;width:260px;
      transition:all .18s;box-shadow:0 4px 10px rgba(0,0,0,.1)
    }
    .button:hover{background:#b3e572;transform:translateY(-3px)}

    .download-status{
      margin-top:12px;color:#2e7d32;
      font-weight:500;font-size:1rem;display:none
    }

    @media (max-width:550px){
      h1{font-size:1.9rem;margin-bottom:2rem}
      .button{font-size:1.05rem;width:80vw;padding:12px}
      .logout-btn{top:12px;left: 0px;font-size:.9rem}
    }

  </style>
</head>

<body>

  <div class="overlay"></div>

  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="container">
    <h1>Admin Dashboard</h1>

    <button class="button" onclick="navigateTo('AdminPlants.html')">üåø Plants</button>
    <button class="button" onclick="navigateTo('AdminFishes.html')">üê† Fishes</button>
    <button class="button" id="downloadBtn" onclick="downloadData()">‚¨áÔ∏è Download Data</button>

    <div class="download-status" id="downloadStatus">Preparing download...</div>
  </div>

<!-- ‚úÖ CONFIG MUST LOAD FIRST -->
<script src="js/config.js"></script>

<script>
  // FINAL Backend API (from config.js)
  const API_BASE = window.__ENV.API_BASE;

  // ADMIN AUTH CHECK
  const role = localStorage.getItem("role");
  if (role !== "admin") {
    window.location.href = "Login.html";
  }

  function navigateTo(page) {
    window.location.href = page;
  }

  async function downloadData() {
    const status = document.getElementById("downloadStatus");
    status.style.display = "block";
    status.textContent = "Preparing download...";

    try {
      const token = localStorage.getItem("sb_token");
      if (!token) throw new Error("Missing admin token");

      const res = await fetch(`${API_BASE}/api/export`, {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });

      if (!res.ok) throw new Error();

      const blob = await res.blob();
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "MyGardenBook_Data.csv";
      a.click();

      URL.revokeObjectURL(url);
      status.textContent = "‚úÖ Download complete!";
      setTimeout(() => status.style.display="none", 2000);

    } catch {
      status.textContent = "‚ùå Failed to download";
      setTimeout(() => status.style.display="none", 2000);
    }
  }

  function logout() {
    localStorage.clear();
    window.location.href = "Login.html";
  }
</script>
<script src="js/config.js"></script>
</body>
</html>
