<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Kalam:wght@700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Baloo 2','Kalam',sans-serif}
    body{
      background:url('Bg.png') no-repeat center center fixed;
      background-size:cover;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      position:relative;
    }
    .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.7);z-index:0}
    .logout-btn{
      position:absolute;top:20px;right:20px;background:#BFE7BC;border:none;border-radius:12px;padding:10px 20px;cursor:pointer;font-weight:700;font-size:.95rem;color:#1A2B10;z-index:2;transition:all .18s
    }
    .logout-btn:hover{background:#A5D39B;transform:translateY(-2px)}
    .container{position:relative;z-index:1;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}
    h1{color:#2e5015;font-size:2.2rem;font-weight:700;margin-bottom:2.5rem;letter-spacing:.5px}
    .button{background:#BFE7BC;color:#1A2B10;border:none;border-radius:20px;padding:14px 40px;margin:10px 0;font-size:1.15rem;font-weight:600;cursor:pointer;width:230px;transition:all .18s;box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .button:hover{background:#b3e572;transform:translateY(-3px)}
    .download-status{margin-top:10px;color:#2e7d32;font-weight:500;font-size:1rem;display:none}
    @media (max-width:600px){h1{font-size:1.8rem;margin-bottom:2rem}.button{font-size:1rem;width:200px;padding:12px 25px}.logout-btn{top:12px;right:12px;padding:8px 14px;font-size:.9rem}}
  </style>
</head>
<body>

  <!-- CONFIG: put your real URLs here -->
  <script>
    /**
     * Configuration / Platform Detection
     *
     * Edit the URLs below to match your deployed endpoints.
     * You can also override at runtime by:
     *  - setting window.__API_BASE = "https://your-api" BEFORE this script runs, OR
     *  - adding ?api=https://your-api to the URL.
     *
     * Cloudinary base is used if you decide to rewrite image URLs client-side.
     */
    const CONFIG = {
      platforms: {
        render: { apiBase: "https://mygardenbook-backend.onrender.com" },
        vercel: { apiBase: "https://mygardenbook.vercel.app" },          // example: your vercel frontend or serverless backend
        supabase: { apiBase: "https://<your-supabase-function-endpoint>" } // e.g. your supabase function/edge endpoint
      },
      cloudinaryBase: "https://res.cloudinary.com/YOUR_CLOUD_NAME/image/upload",
      defaultPlatform: "render"
    };

    function resolveApiBase() {
      // 1) Manual global override (useful for local dev or injection)
      if (window.__API_BASE) return window.__API_BASE.replace(/\/$/, "");

      // 2) Query param override ?api=https://...
      const qp = new URLSearchParams(window.location.search).get("api");
      if (qp) return qp.replace(/\/$/, "");

      // 3) Hostname-based detection (basic heuristics)
      const host = window.location.hostname || "";
      if (host.includes("vercel") || host.endsWith(".vercel.app")) return CONFIG.platforms.vercel.apiBase;
      if (host.includes("onrender") || host.endsWith("render.com") || host.includes("render")) return CONFIG.platforms.render.apiBase;
      if (host.includes("supabase") || host.endsWith("supabase.co")) return CONFIG.platforms.supabase.apiBase;

      // 4) Default fallback
      return CONFIG.platforms[CONFIG.defaultPlatform].apiBase;
    }

    // Make resolved API_BASE available globally for other scripts
    const API_BASE = "https://mygardenbook-backend.onrender.com";
    window.__RESOLVED_API_BASE = API_BASE;
    // (Optionally) expose cloudinary base too
    window.__CLOUDINARY_BASE = CONFIG.cloudinaryBase;
  </script>

  <!-- ADMIN check early to avoid flash -->
  <script>
    const username = localStorage.getItem("username");
    const role = localStorage.getItem("role");
    if (!username || role !== "admin") {
      // Not an admin ‚Äî redirect to login immediately
      window.location.href = "Login.html";
    }
  </script>

  <div class="overlay"></div>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="container">
    <h1>Admin Dashboard</h1>

    <button class="button" onclick="navigateTo('AdminPlants.html')">üåø Plants</button>
    <button class="button" onclick="navigateTo('AdminFishes.html')">üê† Fishes</button>
    <button class="button" id="downloadBtn" onclick="downloadData()">‚¨áÔ∏è Download Data</button>

    <div class="download-status" id="downloadStatus">Preparing download...</div>
  </div>

  <script>
    // Use the resolved API base set earlier
    const API = window.__RESOLVED_API_BASE || "https://mygardenbook-backend.onrender.com";

    function navigateTo(page) {
      window.location.href = page;
    }

    async function downloadData() {
      const status = document.getElementById("downloadStatus");
      status.style.display = "block";
      status.textContent = "Preparing download...";

      try {
        // Export endpoint ‚Äî may differ depending on your backend. Adjust if needed.
        const res = await fetch(`${API}/api/export`);
        if (!res.ok) throw new Error(`Export failed (${res.status})`);

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "MyGardenBook_Data.xlsx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        status.textContent = "‚úÖ Download complete!";
        setTimeout(()=> status.style.display="none",2000);
      } catch (err) {
        console.error("Download failed:", err);
        status.textContent = "‚ùå Failed to download data.";
        setTimeout(()=> status.style.display="none",3000);
      }
    }

    function logout() {
      localStorage.clear();
      window.location.href = "Login.html";
    }

    // For debugging: show resolved backend in console
    console.info("Admin page using API base:", API, "(cloudinary base:", window.__CLOUDINARY_BASE, ")");
  </script>
</body>
</html>
