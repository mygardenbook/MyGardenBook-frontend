<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Plants</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Kalam:wght@700&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Baloo 2','Kalam',sans-serif;
    background: url('Bg.png') no-repeat center center fixed;
    background-size: cover;
    min-height: 100vh;
    position: relative;
  }

  body::before {
    content:"";
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(255,255,255,0.7);
    z-index:0;
  }

  .content {
    position: relative;
    z-index: 5;
    padding-top: 3.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .back-arrow {
    position: fixed;
    top: 16px;
    left: 16px;
    width: 34px;
    height: 34px;
    border: none;
    background: none;
    cursor: pointer;
    z-index: 10;
  }

  .search-wrap {
    width: 90%;
    max-width: 600px;
    margin: 1rem auto 2rem auto;
  }

  .search-box {
    display: flex;
    align-items: center;
    background: #fff;
    padding: 0.7rem 1rem;
    border-radius: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .search-box input {
    border: none;
    outline: none;
    width: 100%;
    font-size: 1rem;
    background: none;
    margin-left: 8px;
  }

  .grid {
    width: 90%;
    max-width: 700px;
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 1rem;
    margin-bottom: 2.5rem;
  }

  .card {
    background:#BFE7BC;
    padding: 0.7rem;
    border-radius: 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    text-align:center;
    cursor:pointer;
    transition: transform .15s ease;
  }

  .card:hover { transform: scale(1.04); }

  .card img {
    width: 70px;
    height: 70px;
    border-radius: 12px;
    object-fit: cover;
    border: 2px solid #4A771C;
  }

  .card-name {
    margin-top: 0.5rem;
    font-size: 1.05rem;
    color: #1A2B10;
  }

  @media (max-width:600px) {
    .grid { gap: 0.8rem; }
    .card img { width: 64px; height: 64px; }
  }
</style>

</head>

<body>

<button class="back-arrow" onclick="window.location.href='User.html'">
  <svg viewBox="0 0 30 30" width="100%" height="100%">
    <polyline points="20,6 10,15 20,24"
              fill="none" stroke="#262A23" stroke-width="4"
              stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

<div class="content">

  <div class="search-wrap">
    <div class="search-box">
      <svg width="20" height="20" viewBox="0 0 24 24">
        <circle cx="10" cy="10" r="7" stroke="#4A771C" stroke-width="2" fill="none"/>
        <line x1="15" y1="15" x2="20" y2="20" stroke="#4A771C" stroke-width="2"/>
      </svg>
      <input id="searchInput" placeholder="Search for a plant..." oninput="filterPlants()">
    </div>
  </div>

  <div class="grid" id="plantGrid"></div>

</div>

<script>
  const API_BASE = "https://mygardenbook-backend.onrender.com";

  function pick(...values) {
    return values.find(v => v !== undefined && v !== null && String(v).trim() !== "") || null;
  }

  function resolveImg(src) {
    if (!src) return null;
    if (src.startsWith("http")) return src;
    if (src.startsWith("/")) return API_BASE + src;
    return src;
  }

  function plantId(p) {
    return pick(p.id, p._id, p.plantId, p.plant_id);
  }

  async function loadPlants() {
    const res = await fetch(`${API_BASE}/api/plants`);
    const plants = await res.json();
    window.allPlants = plants;
    renderPlants(plants);
  }

  function renderPlants(plants) {
    const grid = document.getElementById("plantGrid");
    grid.innerHTML = "";

    if (!plants.length) {
      grid.innerHTML = "<p>No plants found.</p>";
      return;
    }

    plants.forEach(p => {
      const img = resolveImg(pick(p.image, p.image_url, p.imageUrl, p.img, p.photo));
      const name = pick(p.name, p.commonName, p.scientific_name) || "Unknown";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${img || 'placeholder.jpg'}" />
        <div class="card-name">${name}</div>
      `;
      card.onclick = () =>
        window.location.href = `UserEachPlant.html?id=${encodeURIComponent(plantId(p))}`;
      grid.appendChild(card);
    });
  }

  function filterPlants() {
    const q = document.getElementById("searchInput").value.toLowerCase();
    const filtered = window.allPlants.filter(p =>
      (pick(p.name, p.commonName, p.scientific_name) || "").toLowerCase().includes(q) ||
      (p.category || "").toLowerCase().includes(q)
    );
    renderPlants(filtered);
  }

  loadPlants();
</script>

<script src="/js/config.js"></script>

</body>
</html>
