<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>User - Plant Categories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Baloo 2','Kalam','Arial',sans-serif;
    background: url('Bg.png') no-repeat center center fixed;
    background-size: cover;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  /* White overlay */
  body::before {
    content:"";
    position:fixed;
    width:100%; height:100%;
    top:0; left:0;
    background:rgba(255,255,255,0.64);
    z-index:0;
  }

  .container {
    position:relative;
    z-index:5;
    max-width:520px;
    margin:25px auto 40px auto;
    padding:0 4vw 40px 4vw;
  }

  .back-arrow {
    position:fixed;
    top:16px; left:16px;
    background:none;
    border:none;
    cursor:pointer;
    width:32px;
    height:32px;
    z-index:10;
    padding:0;
  }

  .categories-header {
    background:#A6DEAA;
    border-radius:34px;
    text-align:center;
    font-size:1.9rem;
    font-weight:500;
    color:#222e12;
    margin:75px auto 30px auto;
    padding:14px 0;
    width:95%;
  }

  .categories-grid {
    display:grid;
    grid-template-columns:repeat(2, 1fr);
    gap:20px 14px;
    justify-items:center;
  }

  .category-card {
    background:#A6DEAA;
    border-radius:24px;
    width:120px;
    height:180px;
    padding:14px 8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    cursor:pointer;
    transition:0.15s ease;
    box-shadow:0 2px 10px rgba(0,0,0,0.1);
  }

  .category-card:hover {
    transform:scale(1.04);
    background:#8BC48A;
    box-shadow:0 8px 18px rgba(32,71,36,0.12);
  }

  .category-img {
    width:85px;
    height:65px;
    border-radius:14px;
    background:#d3f6d1;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-bottom:14px;
  }

  .category-img img {
    width:100%;
    height:100%;
    object-fit:cover;
    border-radius:14px;
  }

  .category-label {
    background:#244a22;
    color:white;
    border-radius:12px;
    padding:10px 2px;
    text-align:center;
    width:94%;
    font-size:1rem;
    letter-spacing:0.5px;
  }

  .status-msg {
    text-align:center;
    margin-top:15px;
    font-size:1rem;
    color:#204d1e;
    min-height:1em;
  }

  /* Mobile adjustments */
  @media (max-width:600px) {
    .categories-header { font-size:1.5rem; margin-top:65px; }
    .category-card { width:42vw; height:140px; }
    .category-img { width:70px; height:55px; }
    .category-label { font-size:0.9rem; padding:7px 2px; }
    .back-arrow { width:26px; height:26px; top:12px; left:12px; }
  }
</style>
</head>

<body>

<button class="back-arrow" onclick="window.location.href='UserPlants.html'">
  <svg viewBox="0 0 30 30" width="100%" height="100%">
    <polyline points="20,6 10,15 20,24"
      fill="none" stroke="#262A23" stroke-width="4"
      stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

<div class="container">

  <div class="categories-header">Plant Categories</div>

  <div class="categories-grid" id="categoriesGrid">
    <!-- Will be replaced dynamically -->
    <p style="grid-column:1/3; text-align:center; color:#204d1e;">Loading categories...</p>
  </div>

  <div id="statusMsg" class="status-msg"></div>

</div>

<script>
const API_BASE = "https://mygardenbook-backend.onrender.com";
const grid = document.getElementById("categoriesGrid");
const msgEl = document.getElementById("statusMsg");

function pick(...values) {
  return values.find(v => v !== undefined && v !== null && String(v).trim() !== "") || null;
}

function resolveImg(src) {
  if (!src) return null;
  if (/^https?:\/\//.test(src)) return src;
  if (src.startsWith("/")) return API_BASE.replace(/\/$/, "") + src;
  return src;
}

function showMessage(msg, type="info") {
  msgEl.textContent = msg;
  msgEl.style.color = type === "error" ? "#b22222" : "#204d1e";
  setTimeout(() => msgEl.textContent = "", 2500);
}

async function loadPlants() {
  try {
    const res = await fetch(`${API_BASE}/api/plants`);
    if (!res.ok) throw new Error("Failed to fetch plants");
    const plants = await res.json();
    renderCategories(plants);
  } catch (err) {
    console.error(err);
    showMessage("Failed to load categories", "error");
  }
}

function renderCategories(plants) {
  const categories = {};

  (plants || []).forEach(p => {
    const cat = pick(p.category, p.category_name, p.categoryName);
    if (!cat) return;

    if (!categories[cat]) {
      const img = pick(p.image, p.image_url, p.imageUrl, p.img, p.photo);
      categories[cat] = img || "";
    }
  });

  const entries = Object.entries(categories);

  if (!entries.length) {
    grid.innerHTML = "<p>No categories available.</p>";
    return;
  }

  grid.innerHTML = entries.map(([cat, img]) => {
    const resolved = resolveImg(img);
    const imgHtml = resolved
      ? `<img src="${resolved}" alt="${cat}">`
      : `<span style='font-size:1.7rem; color:#4A771C;'>&#127793;</span>`;

    return `
      <div class="category-card" onclick="location.href='UserEachPlantCategory.html?category=${encodeURIComponent(cat)}'">
        <div class="category-img">${imgHtml}</div>
        <div class="category-label">${cat}</div>
      </div>
    `;
  }).join("");
}

loadPlants();
</script>

<script src="/js/config.js"></script>
</body>
</html>
