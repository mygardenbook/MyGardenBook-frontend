<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login / Signup - My Garden Book</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Kalam:wght@700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Baloo 2','Kalam',sans-serif;
      background: url('Bg.png') no-repeat center center fixed;
      background-size: cover;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      position:relative;
    }
    body::before{
      content:""; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(255,255,255,0.7); z-index:0;
    }
    .card {
      z-index:2; width:92%; max-width:420px; background:rgba(143,216,113,0.45);
      padding:1.6rem 1.8rem; border-radius:18px; box-shadow:0 8px 30px rgba(0,0,0,0.12);
    }
    .title { text-align:center; font-size:1.6rem; font-weight:700; margin-bottom:12px; color:#204d1e; }
    .tabs { display:flex; gap:8px; margin-bottom:12px; }
    .tab {
      cursor:pointer; flex:1; padding:8px 10px; border-radius:12px;
      text-align:center; font-weight:600; background:#d7efce; transition:0.18s;
    }
    .tab.active { background:#BFE7BC; color:#1A2B10; box-shadow:0 3px 10px rgba(0,0,0,0.12); }
    .forms { width:200%; display:flex; transition:transform 0.28s ease; }
    form { width:100%; display:flex; flex-direction:column; gap:10px; }
    input { border-radius:10px; border:2px solid #66A03A; padding:10px 12px; font-size:1rem; background:white; outline:none; }
    .btn { background:#BFE7BC; border:none; padding:10px; border-radius:12px; font-size:1.05rem; cursor:pointer; font-weight:600; }
    .btn:hover { background:#b3e572; }
    .helper { font-size:0.95rem; color:#2e7d32; text-align:center; min-height:1rem; }
  </style>
</head>

<body>
  <div class="card">
    <div class="title">My Garden Book</div>

    <!-- MAIN TABS -->
    <div class="tabs">
      <div id="userTab" class="tab active">User Login / Signup</div>
      <div id="adminTab" class="tab">Admin Login</div>
    </div>

    <div style="overflow:hidden;">
      <div class="forms" id="formSlider">

        <!-- USER PANEL -->
        <div style="width:100%; padding-right:12px;">
          
          <!-- LOGIN / SIGNUP SWITCH -->
          <div style="display:flex; gap:8px; margin-bottom:10px;">
            <button id="uLoginBtn" class="innerTab active" style="flex:1;">Login</button>
            <button id="uSignupBtn" class="innerTab" style="flex:1;">Sign up</button>
          </div>

          <!-- USER LOGIN -->
          <form id="userLoginForm">
            <input id="userLoginEmail" type="email" placeholder="Email" required />
            <input id="userLoginPass" type="password" placeholder="Password" required />
            <button class="btn" type="submit">Login</button>
            <div id="userLoginMsg" class="helper"></div>
          </form>

          <!-- USER SIGNUP -->
          <form id="userSignupForm" style="display:none;">
            <input id="userSignupEmail" type="email" placeholder="Email" required />
            <input id="userSignupPass" type="password" placeholder="Create password" required />
            <input id="userSignupConfirm" type="password" placeholder="Confirm password" required />
            <button class="btn" type="submit">Create account</button>
            <div id="userSignupMsg" class="helper"></div>
          </form>
        </div>

        <!-- ADMIN PANEL -->
        <div style="width:100%; padding-left:12px;">
          <form id="adminLoginForm">
            <input id="adminEmail" type="email" placeholder="Admin email" required />
            <input id="adminPass" type="password" placeholder="Admin password" required />
            <button class="btn" type="submit">Admin Login</button>
            <div id="adminMsg" class="helper"></div>
          </form>
        </div>

      </div>
    </div>

  </div>

<!-- SUPABASE (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.44.4/dist/umd/supabase.min.js"></script>

<script>
  /************************************
   * CONFIG & SUPABASE CLIENT INIT
   ************************************/
  const SUPABASE_URL = "https://ctoqycjzmfvdvgnirlkp.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR...";
  const BACKEND_BASE = "https://mygardenbook-backend.onrender.com";

  // FIXED CLIENT INITIALIZATION
  const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


  /************************************
   * TAB SWITCH (USER <-> ADMIN)
   ************************************/
  const userTab = document.getElementById("userTab");
  const adminTab = document.getElementById("adminTab");
  const formSlider = document.getElementById("formSlider");

  userTab.onclick = () => {
    userTab.classList.add("active");
    adminTab.classList.remove("active");
    formSlider.style.transform = "translateX(0%)";
  };

  adminTab.onclick = () => {
    adminTab.classList.add("active");
    userTab.classList.remove("active");
    formSlider.style.transform = "translateX(-50%)";
  };


  /************************************
   * USER LOGIN / SIGNUP TOGGLE
   ************************************/
  const uLoginBtn = document.getElementById("uLoginBtn");
  const uSignupBtn = document.getElementById("uSignupBtn");
  const userLoginForm = document.getElementById("userLoginForm");
  const userSignupForm = document.getElementById("userSignupForm");
  const userLoginMsg = document.getElementById("userLoginMsg");
  const userSignupMsg = document.getElementById("userSignupMsg");

  uLoginBtn.onclick = () => {
    uLoginBtn.classList.add("active");
    uSignupBtn.classList.remove("active");
    userLoginForm.style.display = "flex";
    userSignupForm.style.display = "none";
    userLoginMsg.textContent = "";
  };

  uSignupBtn.onclick = () => {
    uSignupBtn.classList.add("active");
    uLoginBtn.classList.remove("active");
    userLoginForm.style.display = "none";
    userSignupForm.style.display = "flex";
    userSignupMsg.textContent = "";
  };


  /************************************
   * USER LOGIN
   ************************************/
  userLoginForm.onsubmit = async (e) => {
    e.preventDefault();
    userLoginMsg.textContent = "Signing in...";
    const email = userLoginEmail.value.trim();
    const password = userLoginPass.value.trim();

    const { data, error } = await client.auth.signInWithPassword({ email, password });

    if (error) {
      userLoginMsg.style.color = "red";
      userLoginMsg.textContent = error.message;
      return;
    }

    userLoginMsg.style.color = "green";
    userLoginMsg.textContent = "Login successful!";
    localStorage.setItem("mg_user_id", data.user.id);

    setTimeout(() => window.location.href = "User.html", 600);
  };


  /************************************
   * USER SIGNUP
   ************************************/
  userSignupForm.onsubmit = async (e) => {
    e.preventDefault();
    userSignupMsg.textContent = "Creating account...";

    const email = userSignupEmail.value.trim();
    const pass = userSignupPass.value.trim();
    const confirm = userSignupConfirm.value.trim();

    if (pass !== confirm) {
      userSignupMsg.style.color = "red";
      userSignupMsg.textContent = "Passwords do not match";
      return;
    }

    const { data, error } = await client.auth.signUp({ email, password: pass });

    if (error) {
      userSignupMsg.style.color = "red";
      userSignupMsg.textContent = error.message;
      return;
    }

    userSignupMsg.style.color = "green";
    userSignupMsg.textContent = "Account created. Please log in.";
    uLoginBtn.click();
  };


  /************************************
   * ADMIN LOGIN (Backend)
   ************************************/
  adminLoginForm.onsubmit = async (e) => {
    e.preventDefault();
    adminMsg.textContent = "Logging in...";

    const email = adminEmail.value.trim();
    const password = adminPass.value.trim();

    const res = await fetch(`${BACKEND_BASE}/api/admin/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const json = await res.json();

    if (!res.ok) {
      adminMsg.style.color = "red";
      adminMsg.textContent = json.error || "Admin login failed";
      return;
    }

    localStorage.setItem("admin_token", json.token);
    localStorage.setItem("admin_email", json.admin.email);

    adminMsg.style.color = "green";
    adminMsg.textContent = "Login successful!";
    
    setTimeout(() => window.location.href = "Admin.html", 600);
  };

</script>

<script src="js/config.js"></script>

</body>
</html>
