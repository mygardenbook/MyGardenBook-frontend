<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin Fish Categories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&family=Kalam:wght@700&display=swap" rel="stylesheet">

<style>

  /* =========================
     GLOBAL MOBILE FIXES
  ========================== */
  @media (max-width: 600px) {
    .categories-header {
      font-size: 1.6rem !important;
      padding: 12px 0 !important;
      margin-top: 4.5rem !important;
    }
    .category-card {
      width: 42vw !important;
      height: auto !important;
      padding: 1rem !important;
    }
    .category-img {
      width: 72px !important;
      height: 52px !important;
    }
    .category-label {
      font-size: 0.9rem !important;
      padding: 6px !important;
    }
    .action-btn {
      padding: 10px 18px !important;
      font-size: 1rem !important;
    }
    .back-arrow {
      width: 32px !important;
      height: 32px !important;
      top: 12px !important;
      left: 12px !important;
    }
  }

  /* =========================
     BASE STYLES
  ========================== */
  body {
    margin: 0;
    font-family: 'Baloo 2','Kalam','Arial',sans-serif;
    background: url('Bg.png') no-repeat center center fixed;
    background-size: cover;
    position: relative;
    overflow-x: hidden;
    min-height: 100vh;
  }

  .bg-overlay {
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0.64);
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 2;
    max-width: 520px;
    margin: 25px auto 40px auto;
    padding: 0 4vw 40px 4vw;
  }

  /* Topbar */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .back-arrow {
    background: none;
    border: none;
    cursor: pointer;
    width: 36px;
    height: 36px;
    padding: 0;
    position: relative;
    z-index: 10;
  }

  /* Action Buttons */
  .action-btn-group {
    display: flex;
    gap: 16px;
  }

  .action-btn {
    background: #A6DEAA;
    border: none;
    border-radius: 30px;
    padding: 12px 24px;
    font-size: 1.1rem;
    color: #193c10;
    cursor: pointer;
    transition: 0.18s;
    box-shadow: 0 2px 12px rgba(109,164,109,0.12);
  }

  .action-btn.selected {
    background: #7bb37b;
    color: white;
  }

  /* Header */
  .categories-header {
    background: #A6DEAA;
    border-radius: 34px;
    text-align: center;
    font-size: 2rem;
    color: #222e12;
    margin: 50px auto 20px auto;
    padding: 15px 0;
    width: 98%;
    font-weight: 600;
  }

  /* Grid */
  .categories-grid {
    position: relative;
    z-index: 3;
    display: grid;
    grid-template-columns: repeat(2,1fr);
    gap: 22px 16px;
    justify-items: center;
    padding-bottom: 25px;
  }

  .category-card {
    background: #A6DEAA;
    border-radius: 24px;
    width: 130px;
    padding: 15px 6px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: 0.15s ease;
    border: 3px solid transparent;
    box-shadow: 0 2px 10px rgba(109,164,109,0.15);
  }

  .category-card:hover {
    background: #8BC48A;
    transform: scale(1.03);
  }

  .category-card.delete-select {
    border-color: #e46b66;
    background: #e9bdbb;
  }

  .category-img {
    width: 84px;
    height: 62px;
    background: #d3f6d1;
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin-bottom: 15px;
  }

  .category-label {
    background: #204d1e;
    color: white;
    padding: 10px 5px;
    border-radius: 14px;
    width: 94%;
    text-align: center;
    font-size: 1rem;
  }

  .delete-btn-bar {
    text-align: center;
    color: #e46b66;
    font-size: 1.05rem;
    margin: 10px 0;
    display: none;
    font-weight: 600;
  }

  .status-msg {
    text-align: center;
    font-size: 1rem;
    min-height: 1.2rem;
    margin-top: 10px;
    color: #204d1e;
  }

</style>
</head>

<body>

<div class="bg-overlay"></div>

<div class="container">

  <!-- Topbar -->
  <div class="top-bar">
    <button class="back-arrow" onclick="window.location.href='AdminFishes.html'">
      <svg width="30" height="30" viewBox="0 0 30 30">
        <polyline points="20,6 10,15 20,24"
          fill="none" stroke="#193c10" stroke-width="4"
          stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="action-btn-group">
      <button class="action-btn" id="addBtn">Add</button>
      <button class="action-btn" id="deleteBtn">Delete</button>
    </div>
  </div>

  <div class="categories-header">Fish Categories</div>

  <div class="delete-btn-bar" id="deleteInfo">
    Tap categories to select. Tap Delete again to confirm.
  </div>

  <div class="status-msg" id="statusMsg"></div>

  <div class="categories-grid" id="categoriesGrid"></div>

</div>

<!-- ======================
     JAVASCRIPT LOGIC
========================= -->
<script>

  const API_BASE = location.hostname.includes("localhost")
    ? "http://localhost:5000"
    : "https://mygardenbook-backend.onrender.com";

  let categories = [];
  let deleteMode = false;
  let deleteSelected = [];

  const msgEl = document.getElementById("statusMsg");
  const gridEl = document.getElementById("categoriesGrid");
  const deleteInfo = document.getElementById("deleteInfo");
  const addBtn = document.getElementById("addBtn");
  const deleteBtn = document.getElementById("deleteBtn");

  function showMessage(msg, type="info") {
    msgEl.textContent = msg;
    msgEl.style.color =
      type === "error" ? "#b22222" :
      type === "success" ? "#2e7d32" :
      "#204d1e";

    setTimeout(() => { msgEl.textContent = ""; }, 1800);
  }

  async function loadCategories() {
    try {
      const res = await fetch(`${API_BASE}/api/fish-categories`);
      categories = await res.json();
      renderCategories();
    } catch (err) {
      console.error(err);
      showMessage("Failed to load categories", "error");
    }
  }

  async function addCategory() {
    const name = prompt("Enter new category name:");
    if (!name || !name.trim()) return;

    try {
      await fetch(`${API_BASE}/api/fish-categories/add`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name: name.trim() })
      });
      showMessage("Category added!", "success");
      loadCategories();
    } catch (err) {
      showMessage("Error adding category", "error");
    }
  }

  async function toggleDeleteMode() {
    if (!deleteMode) {
      deleteMode = true;
      deleteSelected = [];
      deleteInfo.style.display = "block";
      deleteBtn.classList.add("selected");
      renderCategories();
      showMessage("Select categories to delete");
      return;
    }

    if (deleteSelected.length === 0) {
      exitDeleteMode();
      return;
    }

    if (!confirm(`Delete ${deleteSelected.length} categories?`)) return;

    try {
      await fetch(`${API_BASE}/api/fish-categories/delete`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ names: deleteSelected })
      });

      showMessage("Deleted successfully!", "success");
      loadCategories();
    } catch (err) {
      showMessage("Error deleting", "error");
    }

    exitDeleteMode();
  }

  function exitDeleteMode() {
    deleteMode = false;
    deleteSelected = [];
    deleteInfo.style.display = "none";
    deleteBtn.classList.remove("selected");
    renderCategories();
  }

  function openCategory(name) {
    if (deleteMode) {
      toggleSelect(name);
      return;
    }
    window.location.href = `AdminEachFishCategory.html?category=${encodeURIComponent(name)}`;
  }

  function toggleSelect(name) {
    if (deleteSelected.includes(name)) {
      deleteSelected = deleteSelected.filter(n => n !== name);
    } else {
      deleteSelected.push(name);
    }
    renderCategories();
  }

  function renderCategories() {
    gridEl.innerHTML = "";

    if (!categories.length) {
      gridEl.innerHTML = `<p style="grid-column:1/-1; text-align:center;">No categories yet.</p>`;
      return;
    }

    categories.forEach(cat => {
      const card = document.createElement("div");
      card.className = "category-card";

      if (deleteMode && deleteSelected.includes(cat.name)) {
        card.classList.add("delete-select");
      }

      card.onclick = () => openCategory(cat.name);

      const imgBox = document.createElement("div");
      imgBox.className = "category-img";

      if (cat.img) {
        const img = document.createElement("img");
        img.src = cat.img;
        img.style.width = "100%";
        img.style.height = "100%";
        img.style.objectFit = "cover";
        imgBox.appendChild(img);
      } else {
        imgBox.textContent = "üêü";
        imgBox.style.fontSize = "2rem";
      }

      const label = document.createElement("div");
      label.className = "category-label";
      label.textContent = cat.name;

      card.appendChild(imgBox);
      card.appendChild(label);

      gridEl.appendChild(card);
    });
  }

  addBtn.onclick = addCategory;
  deleteBtn.onclick = toggleDeleteMode;

  loadCategories();

</script>

<script src="/js/config.js"></script>

</body>
</html>
